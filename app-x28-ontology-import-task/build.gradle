apply plugin: 'org.springframework.boot'
apply from: 'jaxb.gradle'
apply from: "${rootProject.rootDir}/gradle/maven-publish.gradle"

dependencies {
    compile project(':application')
    compile project(':infrastructure')
    compile 'org.springframework.boot:spring-boot-starter-batch'
    compile 'org.springframework.cloud:spring-cloud-starter-task'
    compile 'org.springframework.cloud:spring-cloud-starter-stream-kafka'
    compile 'org.springframework.cloud:spring-cloud-starter-config'
    compile 'org.springframework.integration:spring-integration-sftp'
    compile 'org.springframework:spring-oxm'

    compile 'com.h2database:h2'
    compile 'org.postgresql:postgresql'

    compile 'org.codehaus.jackson:jackson-core-asl'
    compile 'com.fasterxml.jackson.core:jackson-annotations'
    compile 'com.fasterxml.jackson.core:jackson-databind'
    compile 'com.fasterxml.jackson.datatype:jackson-datatype-jdk8'
    compile 'com.fasterxml.jackson.module:jackson-module-afterburner'

    testCompile 'org.springframework.batch:spring-batch-test'
    testCompile 'org.springframework.boot:spring-boot-starter-test'
    testCompile 'org.springframework.cloud:spring-cloud-stream-test-support'
    testCompile 'org.springframework.integration:spring-integration-test'
    testCompile 'org.springframework.integration:spring-integration-test-support'

    optional 'org.springframework.boot:spring-boot-configuration-processor'
}

apply plugin: 'io.github.http-builder-ng.http-plugin'
import io.github.httpbuilderng.http.HttpTask
task registerApps(type: HttpTask) {
    group 'spring data flow'
    mustRunAfter 'publish'
    config {
        request.uri = 'http://dev.job-room.ch:9393'
        request.contentType = 'application/x-www-form-urlencoded'
    }
    post {
        request.uri.path = '/apps/task/x28ontologyimport'
        request.body = "force=true&uri=maven://${project.group}:${project.name}:${version}".toString()
    }
}
